# 9. Классы и объекты. Инкапсуляция

## Классы

### Объявление класса

Класс объявляется с помощью ключевого слова  `class`, за которым следует его имя и тело, заключенное в фигурные скобки.
```kotlin
class Student {
    // Тело класса
}
```

### Свойства

Свойства — это переменные, которые хранят данные, связанные с объектом класса. Они объявляются внутри тела класса.
```kotlin
class Student {
    var name: String = ""
    var age: Int = 0
}
```

### Методы

Методы — это функции, которые определяют поведение объекта класса. Они также объявляются внутри тела класса.
```kotlin
class Student {
    var name: String = ""
    var age: Int = 0

    fun getInfo(): String {
        return "Имя: $name, Возраст: $age"
    }
}
```

### Data-классы

Data-классы — это специальные классы, которые автоматически генерируют методы  `equals()`,  `hashCode()`,  `toString()`  и  `copy()`. Они объявляются с помощью ключевого слова  `data`.
```kotlin
data class Book(var title: String, var author: String, var year: Int)
```

## Создание и инициализация объектов



### Конструкторы

Конструкторы используются для инициализации объектов класса. В Kotlin есть два типа конструкторов: первичный конструктор и вторичные конструкторы.

_Первичный конструктор_ объявляется в заголовке класса после имени класса. Он может содержать параметры, которые используются для инициализации свойств класса.

```kotlin
class Student(var name: String, var age: Int) {
    // Тело класса
}
```

_Вторичные конструкторы_ объявляются внутри тела класса с помощью ключевого слова  `constructor`. Они могут вызывать первичный конструктор или другие вторичные конструкторы.
```kotlin
class Student(var name: String, var age: Int) {
    constructor(name: String): this(name, 0)
	constructor(age: Int): this("", age)    
}
```

### Создание объектов

_Создание объектов_ — это процесс _инстанцирования класса_, то есть создания экземпляра класса, который может использоваться для выполнения операций и доступа к свойствам и методам. Создание объектов осуществляется с помощью конструкторов.
```kotlin
fun main() {
    val student = Student("Петр", 21)
    println(student.getInfo()) // Выведет: Имя: Петр, Возраст: 21
}
```

### Аргументы по умолчанию в конструкторах

Аргументы по умолчанию объявляются в первичном конструкторе класса путем присвоения значений параметрам.
```kotlin
class Student(var name: String = "Неизвестный", var age: Int = 18) {
    fun getInfo(): String {
        return "Имя: $name, Возраст: $age"
    }
}
```

Подобным образом аргументы по умолчанию могут объявляться во вторичном конструкторе.
```kotlin
class Student {
    var name: String
    var age: Int

    constructor(name: String = "Неизвестный", age: Int = 18) {
        this.name = name
        this.age = age
    }

    fun getInfo(): String {
        return "Имя: $name, Возраст: $age"
    }
}
```

### Именованные аргументы при вызове конструктора

При вызове конструктора можно явно указывать имена аргументов.
```kotlin
fun main() {
    val student = Student(age = 21, name = "Петр")
    println(student.getInfo()) // Выведет: Имя: Петр, Возраст: 21
}
```

### Блок инициализации
Свойства класса могут быть инициализированы в блоке инициализации `init`, который выполняется при создании объекта класса.
```kotlin
class Student(var name: String, var age: Int) {
    var studentId: String = ""

    init {
        studentId = generateStudentId()
    }

    private fun generateStudentId(): String {
        return "S${System.currentTimeMillis()}"
    }
}
```

### Порядок инициализации

Выполнение кода при создании экземпляра класса определяется следующим порядком:
1.  Первичный конструктор
2.  Блоки инициализации
3.  Вторичные конструкторы

### Поздняя инициализация

_Поздняя инициализация_ (_late initialization_) — это механизм, который позволяет отложить инициализацию свойства до момента, когда оно действительно потребуется. Это особенно полезно в ситуациях, когда свойство не может быть инициализировано во время создания объекта, но гарантированно будет инициализировано до его использования.

В объявлении свойства ключевое слово `lateinit` указывает, что используется  поздняя инициализация. Свойство, объявленное с `lateinit`, должно быть инициализировано до его первого использования.
```kotlin
class Book {
    var title: String
    var author: String
    var year: Int
    lateinit var id: String

    constructor(title: String, author: String, year: Int) {
        this.title = title
        this.author = author
        this.year = year
    }

    fun assignId(id: String) {
        this.id = id
    }

    fun getInfo(): String {
        return if (::id.isInitialized) {
            "Название: $title, Автор: $author, Год издания: $year, ID: $id"
        } else {
            "Название: $title, Автор: $author, Год издания: $year, ID: не назначен"
        }
    }
}

fun main() {
    val book = Book("Война и мир", "Лев Толстой", 1869)
    println(book.getInfo()) // Выведет: Название: Война и мир, Автор: Лев Толстой, Год издания: 1869, ID: не назначен

    book.assignId("BOOK-12345")
    println(book.getInfo()) // Выведет: Название: Война и мир, Автор: Лев Толстой, Год издания: 1869, ID: BOOK-12345
}
```

### Отложенная инициализация

_Отложенная инициализация_ (_lazy initialization_) — это механизм, который позволяет отложить инициализацию свойства до момента, когда оно действительно потребуется. В отличие от поздней инициализации, отложенная инициализация используется для неизменяемых (`val`) свойств и гарантирует, что значение будет присвоено свойству только один раз.

В объявлении свойства ключевое слово `lazy` указывает, что используется отложенная инициализация. Свойство, объявленное с `lazy`, будет инициализировано только при первом обращении к нему.
```kotlin
class Book {
    val title: String
    val author: String
    val year: Int
    val id: String by lazy {
        generateId()
    }

    constructor(title: String, author: String, year: Int) {
        this.title = title
        this.author = author
        this.year = year
    }

    private fun generateId(): String {
        // Пример генерации идентификатора
        return "BOOK-${System.currentTimeMillis()}"
    }

    fun getInfo(): String {
        return "Название: $title, Автор: $author, Год издания: $year, ID: $id"
    }
}

fun main() {
    val book = Book("Война и мир", "Лев Толстой", 1869)
    println(book.getInfo()) // Выведет: Название: Война и мир, Автор: Лев Толстой, Год издания: 1869, ID: BOOK-1234567890
}
```

## Пакеты
_Пакеты_ — это механизм для организации кода в логические группы, что упрощает управление большими проектами и повышает читаемость кода. Пакеты позволяют группировать связанные классы, интерфейсы, функции и другие элементы вместе, а также управлять видимостью этих элементов.

### Объявление пакета

Пакет объявляется в начале файла с помощью ключевого слова  `package`, за которым следует имя пакета. Имя пакета может быть простым или составным, разделенным точками.
```kotlin
package com.company.university

class Student {
    // Тело класса
}
```

### Именование пакетов

При именовании пакетов обычно используется обратная запись доменного имени компании (`com.company`), за которым следует описание функциональности пакета (`university`).

### Импорт пакетов

Чтобы использовать элементы из других пакетов, необходимо их импортировать. Импорт осуществляется с помощью ключевого слова  `import`.
```kotlin
import com.company.university.Student

fun main() {
    val student = Student()
}
```

Если нужно импортировать все элементы из пакета, можно использовать символ `*`.
```kotlin
import com.company.university.*

fun main() {
    val student = Student()
}
```

## Модули

_Модуль_ — это набор файлов Kotlin, которые компилируются вместе. Модули могут содержать несколько пакетов и могут зависеть от других модулей.

## Управление доступом

_Управление доступом_ позволяет контролировать видимость и доступность классов, объектов, функций, свойств и других элементов кода.

Есть четыре уровня видимости:
-   `public`  (по умолчанию): элемент виден везде. 
-   `private`: элемент виден только внутри файла, в котором он объявлен.
-   `protected`: элемент виден только внутри класса и его подклассов.
-   `internal`: элемент виден только внутри модуля.

_Открытый доступ_
```kotlin
class Student {
    public var name: String = ""
}

fun main() {
    val student = Student()
    student.name = "Петр"
    println(student.name) // Выведет: Имя: Петр
}
```

_Закрытый доступ_
```kotlin
class Student {  
	private var name: String = ""  
	fun getName(): String {  
		return this.name  
	}  
	fun setName(name: String) {  
		this.name = name  
	}  
}  
  
fun main() {  
	val student = Student()  
	student.setName("Петр")  
	println(student.getName()) // Выведет: Имя: Петр  
}
```

_Защищенный доступ_
```kotlin
open class Person {
    protected var name: String = ""
}

class Student : Person() {
	fun getName(): String {  
		return this.name  
	}
    fun setName(name: String) {
        this.name = name
    }
}

fun main() {
	val student = Student()  
	student.setName("Петр")  
	println(student.getName()) // Выведет: Имя: Петр  
}
```

_Доступ внутри модуля_
```kotlin
internal class Student {
    internal var name: String = ""
}

fun main() {
    val student = Student()
    student.name = "Петр"
    println(student.name) // Выведет: Имя: Петр
}
```

## Вложенные классы

...

...

... 

## Задание

**Часть I**
Создание классов для описания сущностей "библиотеки", создание объектов этих классов и их инициализация.
1.  Создайте классы для описания следующих сущностей:    
    -   _Книга:_   
        -   Свойства: `индентификатор` (String), `название` (String), `автор` (String), `год издания` (Int), `количество страниц` (Int), `доступна ли книга для выдачи` (Boolean)
        -   Методы:            
            -  `получить информацию о книге`  (возвращает строку с информацией о книге)
            -  `рассчитать время чтения`  (возвращает время, необходимое для чтения книги, предполагая, что читатель прочитывает 20 страниц в час)
            - 	`выдать книгу` изменяет значение свойства `доступна ли книга для выдачи` на  `false`.
            -  `вернуть книгу` изменяет значение свойства `доступна ли книга для выдачи` на  `true`.
    -   _Автор:_
        -   Свойства: имя (String), год рождения (Int), количество книг (Int)
        -   Методы:
            -   `получить информацию об авторе`  (возвращает строку с информацией об авторе)
            -   `рассчитать возраст`  (возвращает возраст автора на текущий год)
    -   _Библиотека:_
        -   Свойства: список книг (List)
        -   Методы:
            -   `добавить книгу`  (добавляет книгу в список)
            -   `добавить книги`  (добавляет несколько книг в список)
            -   `получить список книг`  (возвращает список всех книг в библиотеке)
            -   `получить список книг по автору`  (возвращает список книг, написанных указанным автором)
            -   `получить список книг по году издания`  (возвращает список книг, изданных в указанном году)
            -   `получить список доступных для выдачи книг`
                
2.  Создайте объекты классов:
    -   Создайте несколько объектов класса  `Книга`  с разными значениями свойств.
    -   Создайте несколько объектов класса  `Автор`  с разными значениями свойств.
    -   Создайте объект класса  `Библиотека`.   
    -   Добавьте созданные книги в библиотеку.
    -   Проверьте работу всех методов классов `Книга`, `Автор` и `Библиотека`.

3. Требования к реализации
	- Свойства должны иметь закрытый уровень доступа
	- Доступ к свойства должен осуществляться посредством геттеров и сеттеров
	- Должны выполняться проверки допустимости присваиваемых свойствам значений
	- Должны использоваться первичные и вторичные конструкторы
	- Должны использоваться аргументы по умолчанию в конструкторах
	- Должны использоваться именованные аргументы при вызове конструкторов

**Часть II**

Создание классов для описания сущностей "университета", создание объектов этих классов и их инициализация.
1.  Создайте классы для описания следующих сущностей:
    -   _Студент:_     
        -   Свойства: `индентификатор студента` (String), `имя` (String), `фамилия` (String), `возраст` (Int), `список курсов` (List)          
        -   Методы: 
			 -  `сгенерировать идентификатор студента`
            -   `получить информацию о студенте`  (возвращает строку с информацией о студенте) 
            -   `записаться на курс`  (добавляет курс в список курсов студента)
            -   `получить список курсов`  (возвращает список курсов, на которые записан студент)               
    -   _Преподаватель:_
        -   Свойства: имя (String), фамилия (String), возраст (Int), идентификатор преподавателя (String), список преподаваемых курсов (List)  
        -   Методы:
            -   `получить информацию о преподавателе`  (возвращает строку с информацией о преподавателе) 
            -   `добавить курс`  (добавляет курс в список преподаваемых курсов) 
            -   `получить список преподаваемых курсов`  (возвращает список курсов, которые ведет преподаватель)   
    -   _Курс:_
        -   Свойства: название (String), идентификатор курса (String), преподаватель (Преподаватель), список студентов (List)
        -   Методы: 
            -   `получить информацию о курсе`  (возвращает строку с информацией о курсе)       
            -   `добавить студента`  (добавляет студента в список студентов курса)     
            -   `получить список студентов`  (возвращает список студентов, записанных на курс)        
2.  Создайте объекты классов:
    -   Создайте несколько объектов класса  `Студент`  с разными значениями свойств.
    -   Создайте несколько объектов класса  `Преподаватель`  с разными значениями свойств.
    -   Создайте несколько объектов класса  `Курс`  с разными значениями свойств.
    -   Запишите студентов на курсы.
    -   Назначьте преподавателей на курсы.
    -   Проверьте работу всех методов классов.

3. Требования к реализации
	- Свойства должны иметь закрытый уровень доступа
	- Доступ к свойства должен осуществляться посредством геттеров и сеттеров
	- Должны выполняться проверки допустимости присваиваемых свойствам значений
	- Должны использоваться первичные и вторичные конструкторы
	- Должен использоваться блок инициализации для добавления студентов в список студентов курса.
	- Должны использоваться поздняя инициализация свойства `преподаватель` при создании объектов класса `Курс`.
	- Должна использоваться отложенная инициализация свойства `индентификатор студента` при создании объектов класса `Студент`.
	
**Часть III**

Создание информационной системы "Университет" с интерфейсом командной строки (CLI).

1.  Создайте классы для описания следующих сущностей:
    -   _Студент:_
        -   Свойства: имя (String), фамилия (String), возраст (Int), идентификатор студента (String), список курсов (List), список взятых книг (List)         
        -   Методы:   
            -   `получить информацию о студенте`  (возвращает строку с информацией о студенте)     
            -   `записаться на курс`  (добавляет курс в список курсов студента)  
            -   `получить список курсов`  (возвращает список курсов, на которые записан студент)
            -   `взять книгу`  (добавляет книгу в список взятых книг студента)  
            -   `вернуть книгу`  (удаляет книгу из списка взятых книг студента) 
            -   `получить список взятых книг`  (возвращает список книг, которые взял студент)
    -   _Преподаватель:_
        -   Свойства: имя (String), фамилия (String), возраст (Int), идентификатор преподавателя (String), список преподаваемых курсов (List<Курс>), список рекомендованных книг (List<Книга>)
        -   Методы:
            -   `получить информацию о преподавателе`  (возвращает строку с информацией о преподавателе)
            -   `добавить курс`  (добавляет курс в список преподаваемых курсов)
            -   `получить список преподаваемых курсов`  (возвращает список курсов, которые ведет преподаватель)
            -   `рекомендовать книгу`  (добавляет книгу в список рекомендованных книг)
            -   `получить список рекомендованных книг`  (возвращает список книг, рекомендованных преподавателем)         
    -   _Курс:_
        -   Свойства: название (String), идентификатор курса (String), преподаватель (Преподаватель), список студентов (List<Студент>), список рекомендованных книг (List<Книга>)
        -   Методы:
            -   `получить информацию о курсе`  (возвращает строку с информацией о курсе)
            -   `добавить студента`  (добавляет студента в список студентов курса) 
            -   `получить список студентов`  (возвращает список студентов, записанных на курс)
            -   `добавить рекомендованную книгу`  (добавляет книгу в список рекомендованных книг курса)
            -   `получить список рекомендованных книг`  (возвращает список книг, рекомендованных для курса)       
    -   _Книга:_
        -   Свойства: название (String), автор (String), год издания (Int), количество страниц (Int), доступна ли книга для выдачи (Boolean)
        -   Методы:
            -   `получить информацию о книге`  (возвращает строку с информацией о книге)
            -   `рассчитать время чтения`  (возвращает время, необходимое для чтения книги, предполагая, что читатель прочитывает 20 страниц в час)
            -   `выдать книгу`  (изменяет статус книги на "не доступна для выдачи")
            -   `вернуть книгу`  (изменяет статус книги на "доступна для выдачи")     
    -   _Библиотека:_
        -   Свойства: список книг (List<Книга>)
        -   Методы:
            -   `добавить книгу`  (добавляет книгу в список)
            -   `получить список книг`  (возвращает список всех книг в библиотеке)
            -   `получить список доступных книг`  (возвращает список книг, доступных для выдачи)
            -   `получить список книг по автору`  (возвращает список книг, написанных указанным автором)
            -   `получить список книг по году издания`  (возвращает список книг, изданных в указанном году)
                
2.  Создайте интерфейс командной строки (CLI):
    -   _Главное меню:_   
        -   Управление студентами      
        -   Управление преподавателями    
        -   Управление курсами
        -   Управление библиотекой
        -   Выход
    -   _Подменю "Управление студентами":_
        -   Добавить студента           
        -   Удалить студента    
        -   Просмотреть информацию о студенте
        -   Записать студента на курс
        -   Взять книгу
        -   Вернуть книгу
        -   Назад
    -   _Подменю "Управление преподавателями":_
        -   Добавить преподавателя
        -   Удалить преподавателя
        -   Просмотреть информацию о преподавателе
        -   Добавить курс
        -   Рекомендовать книгу
        -   Назад
    -   _Подменю "Управление курсами":_
        -   Добавить курс
        -   Удалить курс
        -   Просмотреть информацию о курсе
        -   Добавить рекомендованную книгу
        -   Назад
    -   _Подменю "Управление библиотекой":_
        -   Добавить книгу
        -   Удалить книгу
        -   Просмотреть список книг
        -   Просмотреть список доступных книг
        -   Просмотреть список книг по автору
        -   Просмотреть список книг по году издания
        -   Назад
                
3.  Реализуйте функционал для каждого пункта меню:
    -   _Добавить студента:_  запрашивает данные о студенте и создает объект класса  `Студент`.
    -   _Удалить студента:_  запрашивает идентификатор студента и удаляет его из системы.
    -   _Просмотреть информацию о студенте:_  запрашивает идентификатор студента и выводит информацию о нем.    
    -   _Записать студента на курс:_  запрашивает идентификатор студента и идентификатор курса, затем записывает студента на курс.
    -   _Взять книгу:_  запрашивает идентификатор студента и идентификатор книги, затем студент берет книгу из библиотеки.
    -   _Вернуть книгу:_  запрашивает идентификатор студента и идентификатор книги, затем студент возвращает книгу в библиотеку.
    -   _Добавить преподавателя:_  запрашивает данные о преподавателе и создает объект класса  `Преподаватель`.
    -   _Удалить преподавателя:_  запрашивает идентификатор преподавателя и удаляет его из системы.
    -   _Просмотреть информацию о преподавателе:_  запрашивает идентификатор преподавателя и выводит информацию о нем.
    -   _Добавить курс:_  запрашивает данные о курсе и создает объект класса  `Курс`.
    -   _Удалить курс:_  запрашивает идентификатор курса и удаляет его из системы.
    -   _Просмотреть информацию о курсе:_  запрашивает идентификатор курса и выводит информацию о нем.
    -   _Добавить рекомендованную книгу:_  запрашивает идентификатор курса и идентификатор книги, затем добавляет книгу в список рекомендованных для курса.
    -   _Добавить книгу:_  запрашивает данные о книге и создает объект класса  `Книга`.
    -   _Удалить книгу:_  запрашивает идентификатор книги и удаляет ее из библиотеки.
    -   _Просмотреть список книг:_  выводит список всех книг в библиотеке.
    -   _Просмотреть список доступных книг:_  выводит список книг, доступных для выдачи.
    -   _Просмотреть список книг по автору:_  запрашивает имя автора и выводит список книг, написанных этим автором.
    -   _Просмотреть список книг по году издания:_  запрашивает год издания и выводит список книг, изданных в этом году.

 
## Вопросы
1. Классы
2. Свойства
3. Методы
4. Объекты
5. Конструкторы
7. Блок инициализации
8. Поздняя инициализация свойств
9. Отложенная инициализация свойств

## Ресурсы
- [Kotlin. Программирование для профессионалов. 2-е изд. Скин Д., Гринхол Д., Бэйли Э.](https://www.piter.com/collection/yazyki-programmirovaniya/product/kotlin-programmirovanie-dlya-professionalov-2-e-izd) Главы 13-14
- [Kotlin docs: Classes](https://kotlinlang.org/docs/classes.html)
- [Kotlin docs: Properties](https://kotlinlang.org/docs/properties.html)
- [Kotlin docs: Packages and imports](https://kotlinlang.org/docs/packages.html)
- [Руководство по языку Kotlin: Классы](https://kotlinlang.ru/docs/classes.html)
- [Руководство по языку Kotlin: Свойства](https://kotlinlang.ru/docs/properties.html)
- [Руководство по языку Kotlin: Пакеты и импорты](https://kotlinlang.ru/docs/packages.html)